window.onload=(()=>{const e=document,t=e.querySelector("#loginBtn"),n=e.querySelector("#logoutBtn"),r=e.querySelector("#registerBtn"),o=e.querySelector("#nom"),a=e.querySelector("#prenom"),c=e.querySelector("#login"),l=e.querySelector("#password"),s=e.querySelector(".form-signin"),i=e.querySelector("#enchereForm"),d=e.querySelector("#derniereEnchere"),u=e.querySelector("#infosDerniereEnchere"),h=e.querySelector("#inputMontant"),m=e.querySelector("#invalidEnchere"),v=e.querySelector("#enchereSubmit"),g={credentials:"same-origin","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":e.querySelector('meta[name="csrf-token"]').content,cache:"no-cache","Cache-Control":"no-store, no-transform, max-age=0, private","Content-Type":"application/json"},y=()=>{s.classList.add("error"),setTimeout(()=>{s.classList.remove("error")},1e3)};null!==t&&t.addEventListener("click",()=>{0===c.value.length||0===l.value.length?y():fetch("/",{headers:g,method:"post",redirect:"follow",body:JSON.stringify({type:"cnx",action:"connect",username:window.btoa(c.value),hash:window.btoa(md5(l.value))})}).then(e=>e.json()).then(n=>{401===n.status&&"cnx"===n.action&&!1===n.connected?y():200===n.status&&"cnx"===n.action&&!0===n.connected&&(t.dataset.redirect.length?url="/?annonce="+t.dataset.redirect:url="/",e.location.href=url)})}),null!==r&&r.addEventListener("click",()=>{0===c.value.length||0===l.value.length||0===o.value.length||0===a.value.length?y():fetch("/",{headers:g,method:"post",redirect:"follow",body:JSON.stringify({type:"cnx",action:"register",username:window.btoa(c.value),hash:window.btoa(md5(l.value)),nom:window.btoa(o.value),prenom:window.btoa(a.value)})}).then(e=>e.json()).then(t=>{"cnx"===t.action&&!1===t.registered?y():"cnx"===t.action&&!0===t.registered&&(r.dataset.redirect.length?url="/?annonce="+r.dataset.redirect:url="/",e.location.href=url)})}),null!==n&&n.addEventListener("click",()=>{fetch("/",{headers:g,method:"post",body:JSON.stringify({type:"cnx",action:"disconnect"})}).then(e=>e.json()).then(t=>{200===t.status&&"cnx"===t.action&&!0===t.disconnected&&(n.dataset.redirect.length?url="/?annonce="+n.dataset.redirect:url="/",e.location.href=url)})}),null!==v&&v.addEventListener("click",()=>{let e=h.dataset.minenchere;if(parseInt(h.value)<parseInt(e))m.classList.remove("d-none"),h.classList.add("error"),setTimeout(()=>{h.classList.remove("error")},1e3);else{let e=new FormData(i);e.append("enchereSubmit","true"),fetch("/",{method:"POST",enctype:"JSON",body:e}).then(e=>e.json()).then(e=>{if(1==e.success){m.classList.contains("d-none")||m.classList.add("d-none"),console.log(u.innerHTML),console.log(u.innerHTML.length),u.innerHTML.length||u.classList.remove("d-none"),d.innerHTML="Dernière enchère : "+h.value+" €",u.innerHTML="Émise par "+e.prenom+" "+e.nom+" le "+e.date,h.value++,h.setAttribute("min",h.value),h.dataset.minenchere=h.value,m.innerHTML="Entrez un nombre supérieur ou égal à "+h.value;bootstrap.Modal.getInstance("#enchereModal").hide()}})}}),e.querySelector("#to-top").addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})});